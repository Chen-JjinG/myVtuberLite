var e=Object.defineProperty,t=(t,i,a)=>(((t,i,a)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a})(t,"symbol"!=typeof i?i+"":i,a),a);import{E as i,a,b as n,c as r,d as o,e as l,f as s,g as d,h,i as u,j as c,k as m}from"../element-plus/element-plus.087c9c4f.js";import{r as p}from"../../assets/index-0f544eb4.js";import{D as x,r as g,o as y,M as z,O as f,L as w,a8 as v,a as L,f as A,c as R,H as b,Q as M,W as C,u as I,y as D,J as P,ad as k,ae as H,x as U,a3 as E,G as S}from"../@vue/@vue.18e6f8b9.js";import{q as B,r as T,W as V,P as W,t as O,u as j,v as F,G as Q,w as N,x as q,E as K,Q as J,a as Z,b as Y,y as G}from"../three/three.97dd026c.js";import{V as X,a as _,b as $,c as ee}from"../@pixiv/@pixiv.59107a77.js";import{h as te,c as ie,d as ae,p as ne,f as re,a as oe}from"../@mediapipe/@mediapipe.27b6106b.js";import{l as le}from"../@element-plus/@element-plus.f01cebfa.js";import{s as se,a as de,b as he}from"../primevue/primevue.a7fcabad.js";import{S as ue,_ as ce}from"../@jamescoyle/@jamescoyle.c04d327f.js";import{m as me,a as pe,b as xe,c as ge,d as ye,e as ze}from"../@mdi/@mdi.cf2bbdce.js";import{a as fe}from"../axios/axios.791a546b.js";import"../@ctrl/@ctrl.a951068a.js";import"../@vueuse/@vueuse.569ce174.js";import"../lodash-es/lodash-es.01665216.js";import"../@popperjs/@popperjs.b78c3215.js";import"../vue-router/vue-router.94be57ff.js";/* empty css                               */import"../form-data/form-data.31bc4777.js";const we=L("div",{style:{height:"100px",width:"100px",overflow:"hidden",padding:"2px"}},[L("img",{style:{width:"100%",height:"100%","object-fit":"contain"},src:"data:image/png;base64,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"})],-1),ve=L("div",{class:"flex-grow"},null,-1),Le=L("div",{class:"flex-grow"},null,-1),Ae=x({__name:"TopNaviMenu",props:{activeIndexFormPage:String},setup(e){const t=g(e.activeIndexFormPage),r=(e,t)=>{},o=()=>{p.push({name:"studio"}),t.value="1"},l=()=>{p.push({name:"home"}),t.value="0"},s=()=>{p.push({name:"modelContentShare"}),t.value="2-1"},d=()=>{p.push({name:"backgroundContentShare"}),t.value="2-1"};return(e,h)=>{const u=i,c=a,m=n;return y(),z(m,{style:{height:"50px"},"default-active":t.value,class:"el-menu-demo",mode:"horizontal",ellipsis:!1,onSelect:r},{default:f((()=>[w(u,{index:"0",onClick:l},{default:f((()=>[we])),_:1}),ve,w(u,{index:"1",onClick:o},{default:f((()=>[v("VitrualHuman-Studio")])),_:1}),w(c,{index:"2"},{title:f((()=>[v("Content-Share")])),default:f((()=>[w(u,{index:"2-1",onClick:s},{default:f((()=>[v("Vitrual-Model")])),_:1}),w(u,{index:"2-2",onClick:d},{default:f((()=>[v("Vitrual-Background")])),_:1})])),_:1}),Le])),_:1},8,["default-active"])}}}),Re=(e,t,i)=>Math.max(Math.min(e,i),t),be=(e,t,i)=>(Re(e,t,i)-t)/(i-t),Me={Face:{eye:{l:1,r:1},mouth:{x:0,y:0,shape:{A:0,E:0,I:0,O:0,U:0}},head:{x:0,y:0,z:0,width:.3,height:.6,position:{x:.5,y:.5,z:0}},brow:0,pupil:{x:0,y:0}},Pose:{RightUpperArm:{x:0,y:0,z:-1.25},LeftUpperArm:{x:0,y:0,z:1.25},RightLowerArm:{x:0,y:0,z:0},LeftLowerArm:{x:0,y:0,z:0},LeftUpperLeg:{x:0,y:0,z:0},RightUpperLeg:{x:0,y:0,z:0},RightLowerLeg:{x:0,y:0,z:0},LeftLowerLeg:{x:0,y:0,z:0},LeftHand:{x:0,y:0,z:0},RightHand:{x:0,y:0,z:0},Spine:{x:0,y:0,z:0},Hips:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}},RightHand:{RightWrist:{x:-.13,y:-.07,z:-1.04},RightRingProximal:{x:0,y:0,z:-.13},RightRingIntermediate:{x:0,y:0,z:-.4},RightRingDistal:{x:0,y:0,z:-.04},RightIndexProximal:{x:0,y:0,z:-.24},RightIndexIntermediate:{x:0,y:0,z:-.25},RightIndexDistal:{x:0,y:0,z:-.06},RightMiddleProximal:{x:0,y:0,z:-.09},RightMiddleIntermediate:{x:0,y:0,z:-.44},RightMiddleDistal:{x:0,y:0,z:-.06},RightThumbProximal:{x:-.23,y:-.33,z:-.12},RightThumbIntermediate:{x:-.2,y:-.199,z:-.0139},RightThumbDistal:{x:-.2,y:.002,z:.15},RightLittleProximal:{x:0,y:0,z:-.09},RightLittleIntermediate:{x:0,y:0,z:-.225},RightLittleDistal:{x:0,y:0,z:-.1}},LeftHand:{LeftWrist:{x:-.13,y:-.07,z:-1.04},LeftRingProximal:{x:0,y:0,z:.13},LeftRingIntermediate:{x:0,y:0,z:.4},LeftRingDistal:{x:0,y:0,z:.049},LeftIndexProximal:{x:0,y:0,z:.24},LeftIndexIntermediate:{x:0,y:0,z:.25},LeftIndexDistal:{x:0,y:0,z:.06},LeftMiddleProximal:{x:0,y:0,z:.09},LeftMiddleIntermediate:{x:0,y:0,z:.44},LeftMiddleDistal:{x:0,y:0,z:.066},LeftThumbProximal:{x:-.23,y:.33,z:.12},LeftThumbIntermediate:{x:-.2,y:.25,z:.05},LeftThumbDistal:{x:-.2,y:.17,z:-.06},LeftLittleProximal:{x:0,y:0,z:.17},LeftLittleIntermediate:{x:0,y:0,z:.4},LeftLittleDistal:{x:0,y:0,z:.1}}},Ce="Right",Ie="Left",De=Math.PI,Pe=2*Math.PI;class ke{constructor(e,i,a){return t(this,"x"),t(this,"y"),t(this,"z"),Array.isArray(e)?(this.x=e[0]??0,this.y=e[1]??0,void(this.z=e[2]??0)):e&&"object"==typeof e?(this.x=e.x??0,this.y=e.y??0,void(this.z=e.z??0)):(this.x=e??0,this.y=i??0,void(this.z=a??0))}negative(){return new ke(-this.x,-this.y,-this.z)}add(e){return e instanceof ke?new ke(this.x+e.x,this.y+e.y,this.z+e.z):new ke(this.x+e,this.y+e,this.z+e)}subtract(e){return e instanceof ke?new ke(this.x-e.x,this.y-e.y,this.z-e.z):new ke(this.x-e,this.y-e,this.z-e)}multiply(e){return e instanceof ke?new ke(this.x*e.x,this.y*e.y,this.z*e.z):new ke(this.x*e,this.y*e,this.z*e)}divide(e){return e instanceof ke?new ke(this.x/e.x,this.y/e.y,this.z/e.z):new ke(this.x/e,this.y/e,this.z/e)}equals(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new ke(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}length(){return Math.sqrt(this.dot(this))}distance(e,t=3){return 2===t?Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)):Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)+Math.pow(this.z-e.z,2))}lerp(e,t){return e.subtract(this).multiply(t).add(this)}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toSphericalCoords(e={x:"x",y:"y",z:"z"}){return{theta:Math.atan2(this[e.y],this[e.x]),phi:Math.acos(this[e.z]/this.length())}}angleTo(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}toArray(e){return[this.x,this.y,this.z].slice(0,e||3)}clone(){return new ke(this.x,this.y,this.z)}init(e,t,i){return this.x=e,this.y=t,this.z=i,this}static negative(e,t=new ke){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t}static add(e,t,i=new ke){return t instanceof ke?(i.x=e.x+t.x,i.y=e.y+t.y,i.z=e.z+t.z):(i.x=e.x+t,i.y=e.y+t,i.z=e.z+t),i}static subtract(e,t,i=new ke){return t instanceof ke?(i.x=e.x-t.x,i.y=e.y-t.y,i.z=e.z-t.z):(i.x=e.x-t,i.y=e.y-t,i.z=e.z-t),i}static multiply(e,t,i=new ke){return t instanceof ke?(i.x=e.x*t.x,i.y=e.y*t.y,i.z=e.z*t.z):(i.x=e.x*t,i.y=e.y*t,i.z=e.z*t),i}static divide(e,t,i=new ke){return t instanceof ke?(i.x=e.x/t.x,i.y=e.y/t.y,i.z=e.z/t.z):(i.x=e.x/t,i.y=e.y/t,i.z=e.z/t),i}static cross(e,t,i=new ke){return i.x=e.y*t.z-e.z*t.y,i.y=e.z*t.x-e.x*t.z,i.z=e.x*t.y-e.y*t.x,i}static unit(e,t){const i=e.length();return t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,t}static fromAngles(e,t){return new ke(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))}static randomDirection(){return ke.fromAngles(Math.random()*Pe,Math.asin(2*Math.random()-1))}static min(e,t){return new ke(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))}static max(e,t){return new ke(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))}static lerp(e,t,i){return t instanceof ke?t.subtract(e).multiply(i).add(e):(t-e)*i+e}static fromArray(e){return Array.isArray(e)?new ke(e[0],e[1],e[2]):new ke(e.x,e.y,e.z)}static angleBetween(e,t){return e.angleTo(t)}static distance(e,t,i){return 2===i?Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)):Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))}static toDegrees(e){return e*(180/De)}static normalizeAngle(e){let t=e%Pe;return t=t>De?t-Pe:t<-De?Pe+t:t,t/De}static normalizeRadians(e){return e>=De/2&&(e-=Pe),e<=-De/2&&(e=De-(e+=Pe)),e/De}static find2DAngle(e,t,i,a){const n=a-t,r=i-e;return Math.atan2(n,r)}static findRotation(e,t,i=!0){return i?new ke(ke.normalizeRadians(ke.find2DAngle(e.z,e.x,t.z,t.x)),ke.normalizeRadians(ke.find2DAngle(e.z,e.y,t.z,t.y)),ke.normalizeRadians(ke.find2DAngle(e.x,e.y,t.x,t.y))):new ke(ke.find2DAngle(e.z,e.x,t.z,t.x),ke.find2DAngle(e.z,e.y,t.z,t.y),ke.find2DAngle(e.x,e.y,t.x,t.y))}static rollPitchYaw(e,t,i){if(!i)return new ke(ke.normalizeAngle(ke.find2DAngle(e.z,e.y,t.z,t.y)),ke.normalizeAngle(ke.find2DAngle(e.z,e.x,t.z,t.x)),ke.normalizeAngle(ke.find2DAngle(e.x,e.y,t.x,t.y)));const a=t.subtract(e),n=i.subtract(e),r=a.cross(n).unit(),o=a.unit(),l=r.cross(o),s=Math.asin(r.x)||0,d=Math.atan2(-r.y,r.z)||0,h=Math.atan2(-l.x,o.x)||0;return new ke(ke.normalizeAngle(d),ke.normalizeAngle(s),ke.normalizeAngle(h))}static angleBetween3DCoords(e,t,i){e instanceof ke||(e=new ke(e),t=new ke(t),i=new ke(i));const a=e.subtract(t),n=i.subtract(t),r=a.unit(),o=n.unit(),l=r.dot(o),s=Math.acos(l);return ke.normalizeRadians(s)}static getRelativeSphericalCoords(e,t,i,a){e instanceof ke||(e=new ke(e),t=new ke(t),i=new ke(i));const n=t.subtract(e),r=i.subtract(t),o=n.unit(),l=r.unit(),{theta:s,phi:d}=o.toSphericalCoords(a),{theta:h,phi:u}=l.toSphericalCoords(a),c=s-h,m=d-u;return{theta:ke.normalizeAngle(c),phi:ke.normalizeAngle(m)}}static getSphericalCoords(e,t,i={x:"x",y:"y",z:"z"}){e instanceof ke||(e=new ke(e),t=new ke(t));const a=t.subtract(e).unit(),{theta:n,phi:r}=a.toSphericalCoords(i);return{theta:ke.normalizeAngle(-n),phi:ke.normalizeAngle(De/2-r)}}}const He=e=>{const t={r:ke.findRotation(e[11],e[13]),l:ke.findRotation(e[12],e[14])};t.r.y=ke.angleBetween3DCoords(e[12],e[11],e[13]),t.l.y=ke.angleBetween3DCoords(e[11],e[12],e[14]);const i={r:ke.findRotation(e[13],e[15]),l:ke.findRotation(e[14],e[16])};i.r.y=ke.angleBetween3DCoords(e[11],e[13],e[15]),i.l.y=ke.angleBetween3DCoords(e[12],e[14],e[16]),i.r.z=Re(i.r.z,-2.14,0),i.l.z=Re(i.l.z,-2.14,0);const a={r:ke.findRotation(ke.fromArray(e[15]),ke.lerp(ke.fromArray(e[17]),ke.fromArray(e[19]),.5)),l:ke.findRotation(ke.fromArray(e[16]),ke.lerp(ke.fromArray(e[18]),ke.fromArray(e[20]),.5))},n=Ue(t.r,i.r,a.r,Ce),r=Ue(t.l,i.l,a.l,Ie);return{UpperArm:{r:n.UpperArm,l:r.UpperArm},LowerArm:{r:n.LowerArm,l:r.LowerArm},Hand:{r:n.Hand,l:r.Hand},Unscaled:{UpperArm:t,LowerArm:i,Hand:a}}},Ue=(e,t,i,a=Ce)=>{const n=a===Ce?1:-1;return e.z*=-2.3*n,e.y*=De*n,e.y-=Math.max(t.x),e.y-=-n*Math.max(t.z,0),e.x-=.3*n,t.z*=-2.14*n,t.y*=2.14*n,t.x*=2.14*n,e.x=Re(e.x,-.5,De),t.x=Re(t.x,-.3,.3),i.y=Re(2*i.z,-.6,.6),i.z=-2.3*i.z*n,{UpperArm:e,LowerArm:t,Hand:i}},Ee=(e,t)=>{const i=ke.fromArray(t[23]),a=ke.fromArray(t[24]),n=ke.fromArray(t[11]),r=ke.fromArray(t[12]),o=i.lerp(a,1),l=n.lerp(r,1),s=o.distance(l),d={position:{x:Re(o.x-.4,-1,1),y:0,z:Re(s-1,-2,0)}};d.worldPosition={x:d.position.x,y:0,z:d.position.z*Math.pow(-2*d.position.z,2)},d.worldPosition.x*=d.worldPosition.z,d.rotation=ke.rollPitchYaw(e[23],e[24]),d.rotation.y>.5&&(d.rotation.y-=2),d.rotation.y+=.5,d.rotation.z>0&&(d.rotation.z=1-d.rotation.z),d.rotation.z<0&&(d.rotation.z=-1-d.rotation.z);const h=be(Math.abs(d.rotation.y),.2,.4);d.rotation.z*=1-h,d.rotation.x=0;const u=ke.rollPitchYaw(e[11],e[12]);u.y>.5&&(u.y-=2),u.y+=.5,u.z>0&&(u.z=1-u.z),u.z<0&&(u.z=-1-u.z);const c=be(Math.abs(u.y),.2,.4);return u.z*=1-c,u.x=0,Se(d,u)},Se=(e,t)=>(e.rotation&&(e.rotation.x*=Math.PI,e.rotation.y*=Math.PI,e.rotation.z*=Math.PI),t.x*=De,t.y*=De,t.z*=De,{Hips:e,Spine:t});class Be{constructor(e,i,a,n){if(t(this,"x"),t(this,"y"),t(this,"z"),t(this,"rotationOrder"),e&&"object"==typeof e)return this.x=e.x??0,this.y=e.y??0,this.z=e.z??0,void(this.rotationOrder=e.rotationOrder??"XYZ");this.x=e??0,this.y=i??0,this.z=a??0,this.rotationOrder=n??"XYZ"}multiply(e){return new Be(this.x*e,this.y*e,this.z*e,this.rotationOrder)}}const Te={z:.1},Ve=e=>{const t=ke.getSphericalCoords(e[23],e[25],{x:"y",y:"z",z:"x"}),i=ke.getSphericalCoords(e[24],e[26],{x:"y",y:"z",z:"x"}),a=ke.getRelativeSphericalCoords(e[23],e[25],e[27],{x:"y",y:"z",z:"x"}),n=ke.getRelativeSphericalCoords(e[24],e[26],e[28],{x:"y",y:"z",z:"x"}),r=ke.findRotation(e[23],e[24]),o={r:new ke({x:t.theta,y:a.phi,z:t.phi-r.z}),l:new ke({x:i.theta,y:n.phi,z:i.phi-r.z})},l={r:new ke({x:-Math.abs(a.theta),y:0,z:0}),l:new ke({x:-Math.abs(n.theta),y:0,z:0})},s=We(o.r,l.r,Ce),d=We(o.l,l.l,Ie);return{UpperLeg:{r:s.UpperLeg,l:d.UpperLeg},LowerLeg:{r:s.LowerLeg,l:d.LowerLeg},Unscaled:{UpperLeg:o,LowerLeg:l}}},We=(e,t,i=Ce)=>{const a=i===Ce?1:-1;return{UpperLeg:new Be({x:Re(e.x,0,.5)*De,y:Re(e.y,-.25,.25)*De,z:Re(e.z,-.5,.5)*De+a*Te.z,rotationOrder:"XYZ"}),LowerLeg:new Be({x:t.x*De,y:t.y*De,z:t.z*De})}};class Oe{static solve(e,t,{runtime:i="mediapipe",video:a=null,imageSize:n=null,enableLegs:r=!0}={}){if(!e&&!t)return;if(a){const e="string"==typeof a?document.querySelector(a):a;n={width:e.videoWidth,height:e.videoHeight}}if("tfjs"===i&&n){for(const t of e)t.visibility=t.score;for(const e of t)e.x/=n.width,e.y/=n.height,e.z=0,e.visibility=e.score}const o=He(e),l=Ee(e,t),s=r?Ve(e):null,d=e[15].y>.1||(e[15].visibility??0)<.23||.995<t[15].y,h=e[16].y>.1||(e[16].visibility??0)<.23||.995<t[16].y,u=e[23].y>.1||(e[23].visibility??0)<.63||l.Hips.position.z>-.4,c=e[24].y>.1||(e[24].visibility??0)<.63||l.Hips.position.z>-.4;return o.UpperArm.l=o.UpperArm.l.multiply(h?0:1),o.UpperArm.l.z=h?Me.Pose.LeftUpperArm.z:o.UpperArm.l.z,o.UpperArm.r=o.UpperArm.r.multiply(d?0:1),o.UpperArm.r.z=d?Me.Pose.RightUpperArm.z:o.UpperArm.r.z,o.LowerArm.l=o.LowerArm.l.multiply(h?0:1),o.LowerArm.r=o.LowerArm.r.multiply(d?0:1),o.Hand.l=o.Hand.l.multiply(h?0:1),o.Hand.r=o.Hand.r.multiply(d?0:1),s&&(s.UpperLeg.l=s.UpperLeg.l.multiply(c?0:1),s.UpperLeg.r=s.UpperLeg.r.multiply(u?0:1),s.LowerLeg.l=s.LowerLeg.l.multiply(c?0:1),s.LowerLeg.r=s.LowerLeg.r.multiply(u?0:1)),{RightUpperArm:o.UpperArm.r,RightLowerArm:o.LowerArm.r,LeftUpperArm:o.UpperArm.l,LeftLowerArm:o.LowerArm.l,RightHand:o.Hand.r,LeftHand:o.Hand.l,RightUpperLeg:s?s.UpperLeg.r:Me.Pose.RightUpperLeg,RightLowerLeg:s?s.LowerLeg.r:Me.Pose.RightLowerLeg,LeftUpperLeg:s?s.UpperLeg.l:Me.Pose.LeftUpperLeg,LeftLowerLeg:s?s.LowerLeg.l:Me.Pose.LeftLowerLeg,Hips:l.Hips,Spine:l.Spine}}}t(Oe,"calcArms",He),t(Oe,"calcHips",Ee),t(Oe,"calcLegs",Ve);class je{static solve(e,t=Ce){if(!e)return;const i=[new ke(e[0]),new ke(e[t===Ce?17:5]),new ke(e[t===Ce?5:17])],a=ke.rollPitchYaw(i[0],i[1],i[2]);a.y=a.z,a.y-=.4;let n={};return n[t+"Wrist"]={x:a.x,y:a.y,z:a.z},n[t+"RingProximal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[0],e[13],e[14])},n[t+"RingIntermediate"]={x:0,y:0,z:ke.angleBetween3DCoords(e[13],e[14],e[15])},n[t+"RingDistal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[14],e[15],e[16])},n[t+"IndexProximal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[0],e[5],e[6])},n[t+"IndexIntermediate"]={x:0,y:0,z:ke.angleBetween3DCoords(e[5],e[6],e[7])},n[t+"IndexDistal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[6],e[7],e[8])},n[t+"MiddleProximal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[0],e[9],e[10])},n[t+"MiddleIntermediate"]={x:0,y:0,z:ke.angleBetween3DCoords(e[9],e[10],e[11])},n[t+"MiddleDistal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[10],e[11],e[12])},n[t+"ThumbProximal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[0],e[1],e[2])},n[t+"ThumbIntermediate"]={x:0,y:0,z:ke.angleBetween3DCoords(e[1],e[2],e[3])},n[t+"ThumbDistal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[2],e[3],e[4])},n[t+"LittleProximal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[0],e[17],e[18])},n[t+"LittleIntermediate"]={x:0,y:0,z:ke.angleBetween3DCoords(e[17],e[18],e[19])},n[t+"LittleDistal"]={x:0,y:0,z:ke.angleBetween3DCoords(e[18],e[19],e[20])},n=Fe(n,t),n}}const Fe=(e,t=Ce)=>{const i=t===Ce?1:-1,a=["Proximal","Intermediate","Distal"];return e[t+"Wrist"].x=Re(2*e[t+"Wrist"].x*i,-.3,.3),e[t+"Wrist"].y=Re(2.3*e[t+"Wrist"].y,t===Ce?-1.2:-.6,t===Ce?.6:1.6),e[t+"Wrist"].z=-2.3*e[t+"Wrist"].z*i,["Ring","Index","Little","Thumb","Middle"].forEach((n=>{a.forEach((a=>{const r=e[t+n+a];if("Thumb"===n){const e={x:"Proximal"===a?2.2:0,y:"Proximal"===a?2.2:"Intermediate"===a?.7:1,z:.5},n={x:"Proximal"===a?1.2:-.2,y:"Proximal"===a?1.1*i:.1*i,z:.2*i},o={x:0,y:0,z:0};"Proximal"===a?(o.z=Re(n.z+r.z*-De*e.z*i,t===Ce?-.6:-.3,t===Ce?.3:.6),o.x=Re(n.x+r.z*-De*e.x,-.6,.3),o.y=Re(n.y+r.z*-De*e.y*i,t===Ce?-1:-.3,t===Ce?.3:1)):(o.z=Re(n.z+r.z*-De*e.z*i,-2,2),o.x=Re(n.x+r.z*-De*e.x,-2,2),o.y=Re(n.y+r.z*-De*e.y*i,-2,2)),r.x=o.x,r.y=o.y,r.z=o.z}else r.z=Re(r.z*-De*i,t===Ce?-De:0,t===Ce?0:De)}))})),e},Qe=e=>{const t=(e=>{const t=new ke(e[21]),i=new ke(e[251]),a=new ke(e[397]),n=new ke(e[172]);return{vector:[t,i,a.lerp(n,.5)],points:[t,i,a,n]}})(e).vector,i=ke.rollPitchYaw(t[0],t[1],t[2]),a=t[0].lerp(t[1],.5),n=t[0].distance(t[1]),r=a.distance(t[2]);return i.x*=-1,i.z*=-1,{y:i.y*De,x:i.x*De,z:i.z*De,width:n,height:r,position:a.lerp(t[2],.5),normalized:{y:i.y,x:i.x,z:i.z},degrees:{y:180*i.y,x:180*i.x,z:180*i.z}}},Ne={eye:{[Ie]:[130,133,160,159,158,144,145,153],[Ce]:[263,362,387,386,385,373,374,380]},brow:{[Ie]:[35,244,63,105,66,229,230,231],[Ce]:[265,464,293,334,296,449,450,451]},pupil:{[Ie]:[468,469,470,471,472],[Ce]:[473,474,475,476,477]}},qe=(e,t=Ie,{high:i=.85,low:a=.55}={})=>{const n=Ne.eye[t],r=Ke(e[n[0]],e[n[1]],e[n[2]],e[n[3]],e[n[4]],e[n[5]],e[n[6]],e[n[7]]),o=Re(r/.285,0,2);return{norm:be(o,a,i),raw:o}},Ke=(e,t,i,a,n,r,o,l)=>{e=new ke(e),t=new ke(t),i=new ke(i),a=new ke(a),n=new ke(n),r=new ke(r),o=new ke(o),l=new ke(l);const s=e.distance(t,2);return(i.distance(r,2)+a.distance(o,2)+n.distance(l,2))/3/s},Je=(e,t=Ie)=>{const i=new ke(e[Ne.eye[t][0]]),a=new ke(e[Ne.eye[t][1]]),n=i.distance(a,2),r=i.lerp(a,.5),o=new ke(e[Ne.pupil[t][0]]);let l=(r.x-o.x)/(n/2),s=(r.y-.075*n-o.y)/(n/4);return l*=4,s*=4,{x:l,y:s}},Ze=(e,t,{enableWink:i=!0,maxRot:a=.5}={})=>{e.r=Re(e.r,0,1),e.l=Re(e.l,0,1);const n=Math.abs(e.l-e.r),r=i?.8:1.2,o=e.l<.3&&e.r<.3,l=e.l>.6&&e.r>.6;return t>a?{l:e.r,r:e.r}:t<-a?{l:e.l,r:e.l}:{l:n>=r&&!o&&!l?e.l:e.r>e.l?ke.lerp(e.r,e.l,.95):ke.lerp(e.r,e.l,.05),r:n>=r&&!o&&!l?e.r:e.r>e.l?ke.lerp(e.r,e.l,.95):ke.lerp(e.r,e.l,.05)}},Ye=(e,t=Ie)=>{const i=Ne.brow[t],a=Ke(e[i[0]],e[i[1]],e[i[2]],e[i[3]],e[i[4]],e[i[5]],e[i[6]],e[i[7]]),n=.07;return(Re(a/1.15-1,n,.125)-n)/(.125-n)};class Ge{static solve(e,{runtime:t="tfjs",video:i=null,imageSize:a=null,smoothBlink:n=!1,blinkSettings:r=[]}={}){if(!e)return;if(i){const e="string"==typeof i?document.querySelector(i):i;a={width:e.videoWidth,height:e.videoHeight}}if("mediapipe"===t&&a)for(const u of e)u.x*=a.width,u.y*=a.height,u.z*=a.width;const o=Qe(e),l=(e=>{const t=new ke(e[133]),i=new ke(e[362]),a=new ke(e[130]),n=new ke(e[263]),r=t.distance(i),o=a.distance(n),l=new ke(e[13]),s=new ke(e[14]),d=new ke(e[61]),h=new ke(e[291]),u=l.distance(s);let c=u/r,m=d.distance(h)/o;c=be(c,.15,.7),m=be(m,.45,.9),m=2*(m-.3);const p=m,x=be(u/r,.17,.5),g=Re(2*be(p,0,1)*be(x,.2,.7),0,1),y=.4*x+x*(1-g)*.6,z=x*be(1-g,0,.3)*.1;return{x:m||0,y:c||0,shape:{A:y||0,E:be(z,.2,1)*(1-g)*.3||0,I:g||0,O:(1-g)*be(x,.3,1)*.4||0,U:z||0}}})(e);let s=((e,{high:t=.85,low:i=.55}={})=>{if(478!==e.length)return{l:1,r:1};const a=qe(e,Ie,{high:t,low:i}),n=qe(e,Ce,{high:t,low:i});return{l:a.norm||0,r:n.norm||0}})(e,{high:(r=r.length>0?r:"tfjs"===t?[.55,.85]:[.35,.5])[1],low:r[0]});n&&(s=Ze(s,o.y));const d=(e=>{if(478!==e.length)return{x:0,y:0};{const t=Je(e,Ie),i=Je(e,Ce);return{x:.5*(t.x+i.x)||0,y:.5*(t.y+i.y)||0}}})(e),h=(e=>478!==e.length?0:(Ye(e,Ie)+Ye(e,Ce))/2||0)(e);return{head:o,eye:s,brow:h,pupil:d,mouth:l}}}t(Ge,"stabilizeBlink",Ze);const Xe=x({__name:"main3Dscence",props:{vrm_fileid:Number},emits:["getPreviewPosition","cameraOperate","colorChange","openLoading"],setup(e,{expose:t,emit:i}){var a;const n=e,r=be,o=Re;ke.lerp;let l=B();var s=g({x:0,y:1,z:0});let d=g("face");var h=!0;let u=g(n.vrm_fileid);g().value="/api/file/download/"+(null==(a=u.value)?void 0:a.toString())+"/0";const c=new T,m=new V({alpha:!0});function p(e,t){if(e)return m.setClearColor(t),void(c.background=null);var i=(new j).load(t);c.background=i}const x=g();m.setSize(window.innerWidth,window.innerHeight);const z=new W(35,window.innerWidth/window.innerHeight,.1,1e3);z.position.set(0,1.4,.7);const f=new O(z,m.domElement);function w(){x.value.appendChild(m.domElement);const e=new F(16777215);e.position.set(1,1,1).normalize(),c.add(e);const t=new Q;let a;t.renderOrder=1e4,t.clear();const n=new N;n.crossOrigin="anonymous",n.register((e=>new X(e,{helperRoot:t,autoUpdateHumanBones:!0}))),n.load("./source/humanModel/Miku2.vrm",(e=>{const t=e.userData.vrm;_.removeUnnecessaryJoints(e.scene),_.removeUnnecessaryVertices(e.scene),a&&(c.remove(a.scene),_.deepDispose(a.scene)),a=t,a.scene.rotation.y=Math.PI,c.add(t.scene),_.rotateVRM0(t)}),(e=>{i("openLoading",{loadingBool:!0,loadingText:"Loading..."})}),(e=>{}));let u=document.querySelector(".input_video"),p=document.querySelector("canvas.guides");const g=new te.Holistic({locateFile:e=>`../node_modules/@mediapipe/holistic/${e}`});g.crossOrigin="anonymous",g.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,refineFaceLandmarks:!0,minDetectionConfidence:.4,minTrackingConfidence:.4}),g.onResults((e=>{h&&(i("openLoading",{loadingBool:!1,loadingText:"Holistic.."}),h=!h),v(e),w(a,e)}));const y=(e,t={x:0,y:0,z:0,rotationOrder:void 0},i=1,n=.3)=>{if(!a)return;const r=a.humanoid.getNormalizedBoneNode($[e]);if(!r)return;let o=new K(t.x*i,t.y*i,t.z*i,t.rotationOrder||"XYZ"),l=(new J).setFromEuler(o);r.quaternion.slerp(l,n)},f=(e,t={x:0,y:0,z:0},i=1,n=.3)=>{if(!a)return;const r=a.humanoid.getNormalizedBoneNode($[e]);if(!r)return;let o=new Z(t.x*i,t.y*i,t.z*i);r.position.lerp(o,n)},w=(e,t)=>{if(!e)return;let i,n,l,h;const c=t.faceLandmarks,m=t.za,p=t.poseLandmarks,x=t.rightHandLandmarks,g=t.leftHandLandmarks;c&&(h=Ge.solve(c,{runtime:"mediapipe",video:u}),(e=>{var t;if(!a)return;y("Neck",e.head,.7);const i=a.expressionManager,n=ee,l=r(e.mouth.x-.4,0,.5);e.mouth.y;let s={l:e.eye.l,r:e.eye.r},d=0;if(d=o(1*l,0,1),d*=s.l!==s.r?0:1-r(s.l,.2,.8),s.l!==s.r)s.l=o(1-s.l,0,1),s.r=o(1-s.r,0,1),d=0,i.setValue(n.Blink,0),i.setValue(n.BlinkLeft,s.l),i.setValue(n.BlinkRight,s.r);else{const e=o(1-s.l,0,1);i.setValue(n.Blink,e-d),i.setValue(n.BlinkLeft,0),i.setValue(n.BlinkRight,0)}i.setValue(n.Ih,e.mouth.shape.I-d),i.setValue(n.Aa,.8*e.mouth.shape.A-d),i.setValue(n.Ee,.8*e.mouth.shape.E-d),i.setValue(n.Oh,.8*e.mouth.shape.O-d),i.setValue(n.Ou,.8*e.mouth.shape.U-d),i.setValue(n.Happy,0),i.setValue(n.Angry,0),i.setValue(n.Sad,0),i.setValue(n.Relaxed,0),i.setValue(n.Surprised,0),i.setValue(n.Neutral,0);const h=null==(t=e.emotion)?void 0:t.reduce(((e,t)=>e.score>t.score?e:t));switch((null==h?void 0:h.emotion)||""){case"happy":i.setValue(n.Happy,1);break;case"angry":i.setValue(n.Angry,1);break;case"sad":i.setValue(n.Sad,1);break;case"relaxed":i.setValue(n.Relaxed,1);break;case"surprised":i.setValue(n.Surprised,1);break;case"neutral":i.setValue(n.Neutral,1)}let u=new K(e.pupil.y,e.pupil.x,0,"XYZ");const c=Y.RAD2DEG*u.y,m=Y.RAD2DEG*u.x;a.lookAt.applier.applyYawPitch(c,m)})(h)),p&&m&&(i=Oe.solve(m,p,{runtime:"mediapipe",video:u}),y("Chest",i.Spine,.55,.3),y("Spine",i.Spine,.45,.3),y("RightUpperArm",i.RightUpperArm,1,.3),y("RightLowerArm",i.RightLowerArm,1,.3),y("LeftUpperArm",i.LeftUpperArm,1,.3),y("LeftLowerArm",i.LeftLowerArm,1,.3),"full"==d.value?(y("Hips",i.Hips.rotation,.7),f("Hips",{x:i.Hips.position.x+s.value.x,y:i.Hips.position.y+s.value.y,z:-i.Hips.position.z+s.value.z},1,.07),y("LeftUpperLeg",i.LeftUpperLeg,1,.3),y("LeftLowerLeg",i.LeftLowerLeg,1,.3),y("RightUpperLeg",i.RightUpperLeg,1,.3),y("RightLowerLeg",i.RightLowerLeg,1,.3)):(y("Hips",{x:0,y:0,z:0,rotationOrder:void 0},.7),f("Hips",{x:0+s.value.x,y:0+s.value.y,z:0+s.value.z},1,.07))),x&&(n=je.solve(x,"Left"),y("LeftHand",{z:i.LeftHand.z,y:n.LeftWrist.y,x:n.LeftWrist.x,rotationOrder:void 0}),y("LeftRingProximal",n.LeftRingProximal),y("LeftRingIntermediate",n.LeftRingIntermediate),y("LeftRingDistal",n.LeftRingDistal),y("LeftIndexProximal",n.LeftIndexProximal),y("LeftIndexIntermediate",n.LeftIndexIntermediate),y("LeftIndexDistal",n.LeftIndexDistal),y("LeftMiddleProximal",n.LeftMiddleProximal),y("LeftMiddleIntermediate",n.LeftMiddleIntermediate),y("LeftMiddleDistal",n.LeftMiddleDistal),y("LeftThumbProximal",n.LeftThumbProximal),y("LeftThumbIntermediate",n.LeftThumbIntermediate),y("LeftThumbDistal",n.LeftThumbDistal),y("LeftLittleProximal",n.LeftLittleProximal),y("LeftLittleIntermediate",n.LeftLittleIntermediate),y("LeftLittleDistal",n.LeftLittleDistal)),g&&(l=je.solve(g,"Right"),y("RightHand",{z:i.RightHand.z,y:l.RightWrist.y,x:l.RightWrist.x,rotationOrder:void 0}),y("RightRingProximal",l.RightRingProximal),y("RightRingIntermediate",l.RightRingIntermediate),y("RightRingDistal",l.RightRingDistal),y("RightIndexProximal",l.RightIndexProximal),y("RightIndexIntermediate",l.RightIndexIntermediate),y("RightIndexDistal",l.RightIndexDistal),y("RightMiddleProximal",l.RightMiddleProximal),y("RightMiddleIntermediate",l.RightMiddleIntermediate),y("RightMiddleDistal",l.RightMiddleDistal),y("RightThumbProximal",l.RightThumbProximal),y("RightThumbIntermediate",l.RightThumbIntermediate),y("RightThumbDistal",l.RightThumbDistal),y("RightLittleProximal",l.RightLittleProximal),y("RightLittleIntermediate",l.RightLittleIntermediate),y("RightLittleDistal",l.RightLittleDistal))},v=e=>{p.width=u.videoWidth,p.height=u.videoHeight;let t=p.getContext("2d");t.save(),t.clearRect(0,0,p.width,p.height),ae.drawConnectors(t,e.poseLandmarks,ne.POSE_CONNECTIONS,{color:"#00cff7",lineWidth:4}),ae.drawLandmarks(t,e.poseLandmarks,{color:"#ff0364",lineWidth:2}),ae.drawConnectors(t,e.faceLandmarks,re.FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),e.faceLandmarks&&478===e.faceLandmarks.length&&ae.drawLandmarks(t,[e.faceLandmarks[468],e.faceLandmarks[473]],{color:"#ffe603",lineWidth:2}),ae.drawConnectors(t,e.leftHandLandmarks,oe.HAND_CONNECTIONS,{color:"#eb1064",lineWidth:5}),ae.drawLandmarks(t,e.leftHandLandmarks,{color:"#00cff7",lineWidth:2}),ae.drawConnectors(t,e.rightHandLandmarks,oe.HAND_CONNECTIONS,{color:"#22c3e3",lineWidth:5}),ae.drawLandmarks(t,e.rightHandLandmarks,{color:"#ff0364",lineWidth:2})};new ie.Camera(u,{onFrame:async()=>{await g.send({image:u})},width:640,height:480}).start();const L=new q;L.start(),function e(){l.update(),requestAnimationFrame(e),a&&a.update(L.getDelta()),m.render(c,z)}()}return f.screenSpacePanning=!0,f.target.set(0,1.4,0),f.update(),window.addEventListener("resize",(function(){z.aspect=window.innerWidth/window.innerHeight,z.updateProjectionMatrix(),m.setSize(window.innerWidth,window.innerHeight)}),!1),document.addEventListener("keydown",(e=>{var t=.1;switch(e.key){case"d":case"ArrowRight":s.value.x-=t;break;case"a":case"ArrowLeft":s.value.x+=t;break;case"w":case"ArrowUp":s.value.y+=t;break;case"s":case"ArrowDown":s.value.y-=t}})),A((()=>{!function(){const e=document.getElementById("status");l.setMode(0),l.domElement.style.position="relative",l.domElement.style.width="100%",e.appendChild(l.domElement)}(),w(),p(!1,"./source/images/loginBackground.png")})),t({changeTarget:function(e){d.value=e,"face"==d.value?s.value={x:0,y:1,z:0}:"half"==d.value?s.value={x:0,y:1.1,z:1}:"full"==d.value&&(s.value={x:0,y:1.4,z:2})},changeBackground:p}),(e,t)=>(y(),R("div",{id:"threeRef",ref_key:"threeRef",ref:x},null,512))}}),_e={class:"loading"},$e={class:"loading-content"},et=["textContent"],tt=x({__name:"Loding",props:{isLoaing:Boolean},setup(e,{expose:t}){const i=g("...."),a=g();return t({changeVisible:(e,t)=>{a.value=e,i.value=t}}),(e,t)=>{const n=r;return b((y(),R("div",_e,[L("div",$e,[L("div",{style:{width:"100%"},textContent:C(i.value)},null,8,et),w(n,{class:"is-loading",size:40,style:{width:"100%",margin:"10px"}},{default:f((()=>[w(I(le))])),_:1})])],512)),[[M,a.value]])}}}),it=e=>(k("data-v-d7968806"),e=e(),H(),e),at=it((()=>L("div",{style:{height:"10px"}},null,-1))),nt=it((()=>L("div",{style:{height:"10px"}},null,-1))),rt=it((()=>L("div",{style:{height:"30px"}},null,-1))),ot=it((()=>L("div",{id:"status",style:{position:"relative",padding:"0%"}},null,-1))),lt=it((()=>L("div",{style:{height:"100px"}},null,-1))),st=it((()=>L("div",{style:{height:"10px"}},null,-1))),dt=it((()=>L("div",{style:{height:"10px"}},null,-1))),ht=it((()=>L("div",{style:{height:"100px"}},null,-1))),ut=it((()=>L("div",{style:{height:"10px"}},null,-1))),ct={class:"speeddial-circle-demo",style:{position:"fixed",bottom:"90px",right:"85px","z-index":"9"}},mt=ce(x({__name:"OperationSideList",emits:["getPreviewPosition","cameraOperate","colorChange","backgroundChange","openLoading","changeTarget","changeModel"],setup(e,{emit:t}){let i=g(!1);const a=g([{label:"摄像头左下角",icon:"pi pi-arrow-down-left",command:()=>{t("getPreviewPosition","previewLeftBottom")}},{label:"摄像头右下角",icon:"pi pi-arrow-down-right",command:()=>{t("getPreviewPosition","previewRightBottom")}},{label:"摄像头左上角",icon:"pi pi-arrow-up-left",command:()=>{t("getPreviewPosition","previewLeftTop")}},{label:"摄像头右上角",icon:"pi pi-arrow-up-right",command:()=>{t("getPreviewPosition","previewRightTop")}},{label:"摄像头开关",icon:"pi pi-camera",command:()=>{t("cameraOperate",!0)}}]);let n=g("1976D2");const r=g("否"),h=()=>{"是"==r.value?t("colorChange",n.value):t("backgroundChange")},u=e=>{t("changeTarget",e)},c=()=>{t("changeModel")};return(e,t)=>{const m=o,p=l,x=s,g=d;return y(),R(P,null,[at,w(p,{content:"是否为纯色背景: "+r.value,placement:"top"},{default:f((()=>[w(m,{modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),"active-color":"#13ce66",onChange:h,"inactive-color":"#ff4949","active-value":"是","inactive-value":"否"},null,8,["modelValue"])])),_:1},8,["content"]),nt,b(L("div",null,[w(I(se),{modelValue:I(n),"onUpdate:modelValue":t[1]||(t[1]=e=>D(n)?n.value=e:n=e),onChange:h},null,8,["modelValue"])],512),[[M,"是"==r.value]]),b(L("div",null,[w(x,{class:"change-background-button",type:"primary",onClick:h},{default:f((()=>[w(I(ue),{type:"mdi",path:I(me)},null,8,["path"]),v(" 背景切换 ")])),_:1})],512),[[M,"否"==r.value]]),rt,w(g,{placement:"left",visible:I(i),"onUpdate:visible":t[3]||(t[3]=e=>D(i)?i.value=e:i=e)},{reference:f((()=>[w(x,{class:"change-background-button",style:{color:"white"},onClick:t[2]||(t[2]=e=>D(i)?i.value=!0:i=!0)},{default:f((()=>[w(I(ue),{type:"mdi",path:I(pe)},null,8,["path"]),v(" 性能 ")])),_:1})])),default:f((()=>[ot])),_:1},8,["visible"]),lt,w(x,{class:"change-target-button",type:"primary",onClick:t[4]||(t[4]=e=>u("face"))},{default:f((()=>[w(I(ue),{type:"mdi",path:I(xe)},null,8,["path"]),v(" face ")])),_:1}),st,w(x,{class:"change-target-button",type:"primary",onClick:t[5]||(t[5]=e=>u("full"))},{default:f((()=>[w(I(ue),{type:"mdi",path:I(ge)},null,8,["path"]),v(" full ")])),_:1}),dt,w(x,{class:"change-target-button",type:"primary",onClick:t[6]||(t[6]=e=>u("half"))},{default:f((()=>[w(I(ue),{type:"mdi",path:I(ye)},null,8,["path"]),v(" half ")])),_:1}),ht,w(p,{class:"item",effect:"dark",content:"切换模型",placement:"top-start"},{default:f((()=>[w(x,{class:"change-model-button",onClick:c,circle:""},{default:f((()=>[w(I(ue),{type:"mdi",path:I(ze)},null,8,["path"])])),_:1})])),_:1}),ut,L("div",ct,[w(I(de),{model:a.value,radius:120,direction:"up-left",type:"quarter-circle",buttonClass:"p-button-success"},null,8,["model"])])],64)}}}),[["__scopeId","data-v-d7968806"]]),pt={class:"common-layout"},xt={class:"card flex justify-content-center",style:{width:"0",margin:"0%",padding:"0%"}},gt={style:{margin:"10px"}},yt={style:{margin:"10px"}},zt=[L("video",{class:"input_video"},null,-1),L("canvas",{class:"guides"},null,-1)],ft=x({__name:"StudioPage",setup(e){const t=g(!1),i=g(),a=g(),n=g(!1),r=g(!1);let o=g(),l=g("/api/file/download/2/1");const s=e=>{let t=new G;t.setHex(parseInt(e,16)),i.value.changeBackground(!0,t)},d=()=>{n.value=!n.value},p=()=>{r.value=!r.value},x=e=>{i.value.changeTarget(e)},v=e=>{a.value.changeVisible(e.loadingBool,e.loadingText)};let C=g("previewRightTop"),D=g(!1);g(!1);const k=e=>{C.value=e},H=()=>{D.value=!D.value};let B=g(),T=g();A((async()=>{let e=sessionStorage.getItem("token");var t;null!=e&&(B.value=(await(t=Number(e),fe.get("/api/user/own_model/"+(null==t?void 0:t.toString())))).data.model_list,T.value=(await(e=>fe.get("/api/user/own_background/"+(null==e?void 0:e.toString())))(Number(e))).data.background_list);for(let i in B.value);})),g();let V=g();V.value=1;let W=g(!0);return U((()=>{location.reload()})),(e,g)=>{const A=Ae,U=h,O=u,j=c,F=m;return y(),R(P,null,[L("div",null,[w(A,{"active-index-form-page":"1"})]),w(tt,{ref_key:"_Loding",ref:a,isLoaing:t.value},null,8,["isLoaing"]),L("div",pt,[w(F,null,{default:f((()=>[w(O,{width:"0"},{default:f((()=>[L("div",xt,[w(I(he),{visible:n.value,"onUpdate:visible":g[0]||(g[0]=e=>n.value=e),style:{width:"190px"}},{default:f((()=>[(y(!0),R(P,null,E(I(B),(e=>(y(),R("div",{key:e},[L("div",gt,[w(U,{src:"/api/file/download/"+e.toString()+"/3",onClick:t=>(e=>{V.value=e,W.value=!W.value})(e),style:{width:"128px",height:"128px","border-radius":"50%"},fit:"cover"},null,8,["src","onClick"])])])))),128))])),_:1},8,["visible"]),w(I(he),{visible:r.value,"onUpdate:visible":g[1]||(g[1]=e=>r.value=e),style:{width:"190px"}},{default:f((()=>[(y(!0),R(P,null,E(I(T),(e=>(y(),R("div",{key:e},[L("div",yt,[w(U,{src:"/api/file/download/"+e.toString()+"/1",onClick:t=>(e=>{l.value="/api/file/download/"+e.toString()+"/1",i.value.changeBackground(!1,l.value)})(e),style:{width:"128px",height:"128px","border-radius":"50%"},fit:"cover"},null,8,["src","onClick"])])])))),128))])),_:1},8,["visible"])])])),_:1}),w(j,{style:{padding:"0%",position:"relative"}},{default:f((()=>[b(L("div",{class:S(I(C))},zt,2),[[M,I(D)]]),(y(),z(Xe,{onOpenLoading:v,ref_key:"_3Dscene",ref:i,background_color:I(o),vrm_fileid:I(V),key:I(W)},null,8,["background_color","vrm_fileid"]))])),_:1}),w(O,{width:"100px"},{default:f((()=>[w(mt,{onChangeTarget:x,onOpenLoading:v,onColorChange:s,onBackgroundChange:p,onGetPreviewPosition:k,onCameraOperate:H,onChangeModel:d})])),_:1})])),_:1})])],64)}}});export{ft as default};
